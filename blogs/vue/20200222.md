---
title: vuex-persistedstateæ•°æ®æŒä¹…åŒ–
date: 2020-02-22
categories:
  - vue
tags:
  - æ•°æ®æŒä¹…åŒ–
---

> åœ¨ä½¿ç”¨vueå¼€å‘å¤§åž‹SPAä¸­åŽå°é¡¹ç›®æ—¶ï¼Œæ€»æ˜¯ç¦»ä¸å¼€äº¤é”™å¤æ‚çš„æ•°æ®çŠ¶æ€ç®¡ç†ï¼Œå…¶ä¸­vuexå¾ˆå¥½çš„è§£å†³äº†è¿™ç—›ç‚¹
>
> ä½†ç”¨æˆ·æ‰‹åŠ¨åˆ·æ–°é¡µé¢æ—¶ï¼Œvuexä¸­çš„æ•°æ®çŠ¶æ€ä¼šå…¨éƒ¨å˜æˆåˆå§‹çŠ¶æ€å€¼ï¼Œæ¢å¥è¯è¯´å°±æ˜¯æ•°æ®ä¸å¤ŸæŒä¹…ðŸ˜‚
>
> vuex-persistedstateè§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå¯é…ç½®çš„æ•°æ®å­˜å‚¨æ–¹å¼ï¼Œå¯å•ç‹¬é…ç½®vuex module æŒä¹…åŒ–ï¼Œè€Œä¸”å¯ä»¥è¿›è¡ŒåŠ å¯†å­˜å‚¨ðŸ˜€

# 1.å®‰è£…

`npm i vuex-persistedstate --save ` 

## 2. åŸºç¡€é…ç½®

`store/index.js`

```js
import { Store } from "vuex"
import createPersistedState from "vuex-persistedstate"
 
const store = new Store({
  // ...
  plugins: [createPersistedState()],
})
```

# 3. å•ç‹¬ç»™æŸä¸ªvuex module é…ç½®æŒä¹…åŒ–

`store/module/user.js`

```js
export default {
  state: {
    data: {}
  }
  // ...
}
```

`store/index.js`

```js
import user from './module/user'
 
const userModule = createPersistedState({
  paths: ['user']
})
 
export new Vuex.Store({
  modules: {
    user
  },
  plugins: [userModule]
})
```

# 4.æŒ‡å®šå­˜å‚¨æ–¹å¼

`store/index.js`

vuex-persistedstateé»˜è®¤å­˜å‚¨åœ¨localStorageä¸­ï¼Œå¯ä»¥é€šè¿‡é…ç½®å¯ä»¥æŒ‡å®šä¸ºsessionStorageã€ cookieä¸­

`npm i js-cookie --save`

```js
import { Store } from 'vuex'
import createPersistedState from 'vuex-persistedstate'
import * as Cookies from 'js-cookie'

const store = new Store({
  // ...
  plugins: [
    createPersistedState({
      storage: {
        getItem: key => Cookies.get(key),
        setItem: (key, value) => Cookies.set(key, value, { expires: 3, secure: true }),
        removeItem: key => Cookies.remove(key)
      }
    })
  ]
})
```

# 5. æ•°æ®åŠ å¯†å­˜å‚¨

`npm i secure-ls --save`

```js
import { Store } from 'vuex'
import createPersistedState from 'vuex-persistedstate'
import SecureLS from 'secure-ls'
const ls = new SecureLS({ encodingType: 'des', isCompression: false, encryptionSecret: 'my-secret-key' })

const store = new Store({
  // ...
  plugins: [
    createPersistedState({
      storage: {
        getItem: key => ls.get(key),
        setItem: (key, value) => ls.set(key, value),
        removeItem: key => ls.remove(key)
      }
    })
  ]
})
```

